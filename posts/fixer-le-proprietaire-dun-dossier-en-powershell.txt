.. link: 
.. description: 
.. tags: powershell, AD
.. date: 2014/01/07 16:30:23
.. title: Fixer le propriétaire d'un dossier en powershell
.. slug: fixer-le-proprietaire-dun-dossier-en-powershell
.. tribe: powershell


.. class:: alert alert-info

Alors comme ça, on peut pas faire ça en powershell ? chiche.

* Pataquès dans le filesystem & redirection de "mes documents" en erreur ...

.. TEASER_END


D'abord
-------

* Code :

.. code:: powershell

	$folders = Get-ChildItem | where {$_.mode -match "d"} | select Psdrive, parent, name, fullname
	foreach ($folder in $folders) 
	{ 
		$subfolders= Get-ChildItem -Path $folder.name | where {$_.mode -match "d"} | select PSdrive, parent, name, fullname
		foreach ($subfolder in $subfolders)
		{ 
			try
			{
				#$fullpath = "`"" + $subfolder.fullname + "`""		
				$fullpath = $subfolder.fullname
				write-host $subfolder.fullname - $fullpath
				write-host Dossier: $folder.name  -Sous-Dossier: $subfolder.name  -Propriétaire: (get-acl -path $fullpath -erroraction continue).owner
			}
			catch
			{
				write-host Dossier: $folder.name  -Sous-Dossier: $subfolder.name  -backgroundcolor red -Erreur: $_.exception.message	
			}
		}
	}



* Wip ...
	
	set-acl -AclObject -path .\F
	set-acl -AclObject $obj  -path \hd-wf
	
	$obj = get-acl '.\Mes documents'
	$user = new-object system.security.principal.ntaccount("domain","user")
	set-acl -AclObject $obj  -path 
	
	
