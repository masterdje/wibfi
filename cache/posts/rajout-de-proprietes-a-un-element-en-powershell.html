<p class="alert alert-info">Lister les ip réservées c'est bien, les adresses mac associées c'est bien aussi...</p>
<ul class="simple">
<li>Bref, on prend <a class="reference external" href="lister-les-ip-reservees-dun-scope-dhcp-en-powershell.html">une liste d'ip en powershell</a> et on fait mieux !</li>
</ul>
<!-- TEASER_END -->
<div class="section" id="code">
<h2>Code</h2>
<pre class="code powershell literal-block">
<span class="nv">$scope</span> <span class="p">=</span> <span class="nv">$args</span><span class="p">[</span><span class="n">0</span><span class="p">]</span>
<span class="nv">$a</span> <span class="p">=</span> <span class="nb">Invoke-Command</span> <span class="n">-ComputerName</span> <span class="n">monserveur</span><span class="p">.</span><span class="n">fqdn</span> <span class="n">-scriptblock</span><span class="p">{</span><span class="n">netsh</span> <span class="n">dhcp</span> <span class="n">server</span> <span class="n">monserveur</span><span class="p">.</span><span class="n">fqdn</span> <span class="n">scope</span> <span class="nv">$args</span><span class="p">[</span><span class="n">0</span><span class="p">]</span> <span class="n">show</span> <span class="n">reservedip</span><span class="p">}</span> <span class="n">-args</span> <span class="nv">$scope</span>
<span class="nv">$tabl</span><span class="p">=</span> <span class="nv">$a</span><span class="p">[</span><span class="n">7</span><span class="p">..(</span><span class="nv">$a</span><span class="p">.</span><span class="n">length</span><span class="p">-</span><span class="n">6</span><span class="p">)]</span>
<span class="nv">$ip</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ArrayList</span>
<span class="nv">$col</span> <span class="p">=</span> <span class="err">&#64;</span><span class="p">()</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">in</span> <span class="nv">$tabl</span><span class="p">)</span>
<span class="p">{</span>
        <span class="nv">$addip</span><span class="p">=</span> <span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="n">Object</span>
        <span class="nv">$addip</span> <span class="p">|</span><span class="nb">add-member</span> <span class="n">-type</span> <span class="n">NoteProperty</span> <span class="n">-name</span> <span class="n">ip</span> <span class="n">-value</span> <span class="nv">$a</span><span class="p">.</span><span class="n">trim</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="n">0</span><span class="p">].</span><span class="n">trimend</span><span class="p">()</span>
        <span class="nv">$addip</span> <span class="p">|</span><span class="nb">add-member</span> <span class="n">-type</span> <span class="n">NoteProperty</span> <span class="n">-name</span> <span class="n">mac</span> <span class="n">-value</span> <span class="nv">$a</span><span class="p">.</span><span class="n">trim</span><span class="p">().</span><span class="n">substring</span><span class="p">(</span><span class="nv">$a</span><span class="p">.</span><span class="n">trim</span><span class="p">().</span><span class="n">length</span> <span class="p">-</span><span class="n">18</span><span class="p">,</span><span class="n">17</span><span class="p">)</span>
        <span class="nv">$col</span> <span class="p">+=</span> <span class="nv">$addip</span>
<span class="p">}</span>
<span class="nv">$col</span> <span class="p">|</span><span class="nb">out-file</span> <span class="nv">$env:temp</span><span class="p">\</span><span class="n">scope</span><span class="p">.</span><span class="n">txt</span>
</pre>
</div>
<div class="section" id="usage">
<h2>Usage</h2>
<ul class="simple">
<li><strong>Add-member</strong> permet de rajouter une propriété nommée <strong>ip</strong> de type <em>string</em>, alimentée par un trim cracra de la variable <em>tabl[x]</em></li>
<li>... et pareil pour <strong>mac</strong> ... en plus cracra vu la tête du <em>dump netsh</em></li>
<li>et on rajoute tout ça à la variable <strong>$col</strong> bien initialisée en temps qu' <em>array</em> !!</li>
</ul>
</div>
<div class="section" id="a-noter">
<h2>A Noter</h2>
<ul class="simple">
<li>ça marche !</li>
</ul>
</div>
